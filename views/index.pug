extends layout

block content
  div(class="min-h-screen flex flex-col")
    //- Header
    header(class="border-b border-gray-700 h-16 flex items-center px-6")
      div(class="max-w-4xl mx-auto w-full flex items-center justify-between")
        a(href="/" class="font-semibold text-sm tracking-tight flex items-center gap-2")
          span(class="text-lg") ▲
          span InviteChat
        if user
          div(class="flex items-center gap-6 text-sm")
            span(class="text-gray-400") #{user.username}
            a(href="/logout" class="text-gray-400 hover:text-white transition-colors") Logout

    //- Main
    main(class="flex-1 flex items-center justify-center px-6 py-16")
      div(class="w-full max-w-sm")
        if user && paid
          div(class="text-center")
            p(class="text-gray-400 text-sm mb-1 font-mono") authenticated
            h1(class="text-xl font-medium mb-8") #{user.username}
            a(href="/success" class="inline-block border border-gray-600 hover:border-white px-8 py-3 text-sm transition-colors") 
              | Dashboard →
            
        else if paid && !user
          div(class="text-center")
            p(class="text-gray-400 text-sm mb-1 font-mono") payment_confirmed
            h1(class="text-xl font-medium mb-8") Connect accounts
            a(href="/payment-success" class="inline-block border border-gray-600 hover:border-white px-8 py-3 text-sm transition-colors") 
              | Continue →
              
        else
          //- Main payment card
          div(class="space-y-10")
            //- Title
            div(class="text-center")
              h1(class="text-2xl font-medium mb-3") Premium Access
              p(class="text-gray-400 text-sm") Join our Discord & Telegram communities
            
            //- Price block
            div(class="border border-gray-700 p-8 text-center")
              p(class="text-gray-400 text-xs font-mono mb-4 uppercase tracking-wider") Lifetime Access
              p(class="text-5xl font-medium tracking-tight") $3.99
              p(class="text-gray-400 text-sm mt-3") one-time • no subscription
            
            //- Features
            div(class="text-sm space-y-4")
              div(class="flex items-center gap-4")
                span(class="text-gray-500 font-mono text-xs w-8") 01
                span(class="text-gray-200") Discord server + premium role
              div(class="flex items-center gap-4")
                span(class="text-gray-500 font-mono text-xs w-8") 02
                span(class="text-gray-200") Telegram private group
              div(class="flex items-center gap-4")
                span(class="text-gray-500 font-mono text-xs w-8") 03
                span(class="text-gray-200") Instant access after payment
                
            //- CTA
            button#checkout-btn(class="w-full bg-white text-black py-4 text-sm font-medium hover:bg-gray-100 transition-colors")
              | Get Access →
              
            //- Test card
            div(class="border border-dashed border-gray-700 p-5")
              p(class="text-gray-500 text-xs font-mono mb-4 text-center") TEST_MODE
              div(class="space-y-3 font-mono text-sm")
                div(class="flex items-center justify-between text-gray-300")
                  span card
                  div(class="flex items-center gap-2")
                    span 4242 4242 4242 4242
                    button(class="copy-btn text-gray-500 hover:text-white" data-copy="4242424242424242")
                      svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z")
                div(class="flex items-center justify-between text-gray-300")
                  span exp
                  span 12/34
                div(class="flex items-center justify-between text-gray-300")
                  span cvc
                  span 123

    //- Footer
    footer(class="border-t border-gray-700 py-6")
      div(class="max-w-4xl mx-auto px-6 flex items-center justify-between text-xs text-gray-500")
        span © InviteChat
        div(class="flex gap-6")
          a(href="/terms-of-service" class="hover:text-white transition-colors") Terms
          a(href="/privacy-policy" class="hover:text-white transition-colors") Privacy

  script.
    document.querySelectorAll('.copy-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        const value = btn.dataset.copy;
        await navigator.clipboard.writeText(value).catch(() => {});
        const svg = btn.querySelector('svg');
        const original = svg.innerHTML;
        svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 13l4 4L19 7"></path>';
        setTimeout(() => svg.innerHTML = original, 1500);
      });
    });

    document.getElementById('checkout-btn')?.addEventListener('click', async () => {
      const btn = document.getElementById('checkout-btn');
      btn.disabled = true;
      btn.classList.add('opacity-50');
      btn.textContent = 'Processing...';
      
      try {
        const res = await fetch('/create-checkout-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        const data = await res.json();
        if (data.url) window.location.href = data.url;
        else throw new Error(data.error);
      } catch (e) {
        alert(e.message);
        btn.disabled = false;
        btn.classList.remove('opacity-50');
        btn.textContent = 'Get Access →';
      }
    });
