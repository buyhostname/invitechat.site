extends layout

block content
  main(class="min-h-screen flex flex-col")
    //- Header
    nav(class="bg-discord-darkerBg/80 backdrop-blur-md border-b border-discord-border/50 px-4 md:px-6 py-2.5 md:py-3 sticky top-0 z-50")
      div(class="max-w-6xl mx-auto flex items-center justify-between")
        a(href="/" class="flex items-center gap-2 md:gap-2.5 group")
          div(class="w-8 h-8 md:w-9 md:h-9 bg-discord-blurple rounded-full flex items-center justify-center group-hover:bg-discord-blurpleHover transition-colors")
            svg(class="w-4 h-4 md:w-5 md:h-5 text-white" viewBox="0 0 24 24" fill="currentColor")
              path(d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z")
          span(class="text-lg font-semibold text-white") InviteChat
        if user
          div(class="flex items-center gap-3")
            div(class="flex items-center gap-2 bg-discord-darkestBg px-3 py-1.5 rounded-full")
              if user.avatar
                img(src=`https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=32` class="w-6 h-6 rounded-full")
              else
                div(class="w-6 h-6 rounded-full bg-discord-blurple flex items-center justify-center text-white text-xs font-medium")
                  | #{user.username.charAt(0).toUpperCase()}
              span(class="text-discord-textNormal text-sm font-medium") #{user.username}
            a(href="/logout" class="text-discord-textMuted text-sm hover:text-discord-textNormal transition-colors") Log out

    //- Main Content
    div(class="flex-1 flex items-center justify-center p-4 md:p-6")
      div(class="w-full max-w-lg fade-in")
        if user && paid
          //- Already logged in and paid
          div(class="bg-discord-darkerBg rounded-xl p-5 md:p-8 shadow-discord text-center")
            div(class="w-16 h-16 md:w-20 md:h-20 mx-auto mb-4 md:mb-6 rounded-full bg-discord-green/10 flex items-center justify-center")
              svg(class="w-8 h-8 md:w-10 md:h-10 text-discord-green" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z")
            h2(class="text-xl md:text-2xl font-bold text-white mb-2") Welcome back, #{user.username}!
            p(class="text-discord-textMuted text-sm md:text-base mb-6 md:mb-8") Your premium membership is active.
            a(href="/success" class="btn-discord inline-flex items-center gap-2 bg-discord-blurple text-white px-6 md:px-8 py-2.5 md:py-3 rounded-lg font-medium text-sm md:text-base") 
              | Go to Dashboard
              svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6")
            
        else if paid && !user
          //- Paid but not logged in with Discord
          div(class="bg-discord-darkerBg rounded-xl p-5 md:p-8 shadow-discord text-center")
            div(class="w-16 h-16 md:w-20 md:h-20 mx-auto mb-4 md:mb-6 rounded-full bg-discord-green/10 flex items-center justify-center")
              svg(class="w-8 h-8 md:w-10 md:h-10 text-discord-green" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7")
            h2(class="text-xl md:text-2xl font-bold text-white mb-2") Payment Successful!
            p(class="text-discord-textMuted text-sm md:text-base mb-6 md:mb-8") One more step — connect your Discord account to claim your premium role.
            a(href="/login" class="btn-discord flex items-center justify-center gap-2 md:gap-3 bg-discord-blurple text-white px-6 md:px-8 py-3 rounded-lg font-medium text-sm md:text-base w-full")
              svg(class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor")
                path(d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z")
              | Continue with Discord
              
        else
          //- Not paid yet - show payment option
          div(class="bg-discord-darkerBg rounded-xl overflow-hidden shadow-discord-lg")
            //- Premium Badge Header
            div(class="relative bg-gradient-to-r from-discord-blurple via-indigo-500 to-purple-500 p-5 md:p-8 text-center overflow-hidden")
              div(class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width=\"30\" height=\"30\" viewBox=\"0 0 30 30\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cpath d=\"M1.22676 0C1.91374 0 2.45351 0.539773 2.45351 1.22676C2.45351 1.91374 1.91374 2.45351 1.22676 2.45351C0.539773 2.45351 0 1.91374 0 1.22676C0 0.539773 0.539773 0 1.22676 0Z\" fill=\"rgba(255,255,255,0.07)\"%3E%3C/path%3E%3C/svg%3E')] opacity-50")
              div(class="relative")
                div(class="inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-3 md:px-4 py-1 md:py-1.5 rounded-full mb-3 md:mb-4")
                  svg(class="w-4 h-4 text-discord-yellow" fill="currentColor" viewBox="0 0 20 20")
                    path(d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z")
                  span(class="text-white text-xs md:text-sm font-semibold") PREMIUM
                h1(class="text-2xl md:text-3xl font-bold text-white mb-1 md:mb-2") Unlock Premium Access
                p(class="text-white/80 text-sm md:text-base") Join our exclusive Discord community
                
            div(class="p-5 md:p-8")
              //- Price Card
              div(class="bg-discord-darkestBg rounded-xl p-4 md:p-6 mb-4 md:mb-6 border border-discord-border/50")
                div(class="flex items-center justify-between mb-3 md:mb-4")
                  div
                    p(class="text-discord-textMuted text-xs md:text-sm mb-0.5 md:mb-1") Lifetime Access
                    div(class="flex items-baseline gap-1")
                      span(class="text-3xl md:text-4xl font-bold text-white") $3.99
                      span(class="text-discord-textMuted text-xs md:text-sm") USD
                  div(class="bg-discord-green/10 text-discord-green text-xs font-semibold px-2 md:px-3 py-1 md:py-1.5 rounded-full") BEST VALUE
                      
              //- Features
              div(class="space-y-3 md:space-y-4 mb-5 md:mb-8")
                div(class="flex items-start gap-3 md:gap-4")
                  div(class="w-8 h-8 md:w-10 md:h-10 rounded-lg bg-discord-blurple/10 flex items-center justify-center flex-shrink-0")
                    svg(class="w-4 h-4 md:w-5 md:h-5 text-discord-blurple" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                      path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z")
                  div
                    p(class="text-white font-medium text-sm md:text-base") Exclusive Member Role
                    p(class="text-discord-textMuted text-xs md:text-sm") Stand out with a premium badge
                div(class="flex items-start gap-3 md:gap-4")
                  div(class="w-8 h-8 md:w-10 md:h-10 rounded-lg bg-discord-green/10 flex items-center justify-center flex-shrink-0")
                    svg(class="w-4 h-4 md:w-5 md:h-5 text-discord-green" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                      path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z")
                  div
                    p(class="text-white font-medium text-sm md:text-base") Private Channels
                    p(class="text-discord-textMuted text-xs md:text-sm") Access premium-only discussions
                div(class="flex items-start gap-3 md:gap-4")
                  div(class="w-8 h-8 md:w-10 md:h-10 rounded-lg bg-purple-500/10 flex items-center justify-center flex-shrink-0")
                    svg(class="w-4 h-4 md:w-5 md:h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                      path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z")
                  div
                    p(class="text-white font-medium text-sm md:text-base") Priority Support
                    p(class="text-discord-textMuted text-xs md:text-sm") Get help faster from our team
                  
              //- Pay Button
              button#checkout-btn(class="btn-discord w-full bg-discord-blurple text-white py-3 md:py-4 rounded-lg font-semibold text-sm md:text-base transition-all flex items-center justify-center gap-2")
                svg(class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z")
                | Get Premium Access
                
              //- Trust badges
              div(class="flex items-center justify-center gap-4 md:gap-6 mt-4 md:mt-6 pt-4 md:pt-6 border-t border-discord-border/50")
                div(class="flex items-center gap-2 text-discord-textMuted")
                  svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                    path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z")
                  span(class="text-xs") Secure
                div(class="flex items-center gap-2 text-discord-textMuted")
                  svg(class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24")
                    path(d="M13.976 9.15c-2.172-.806-3.356-1.426-3.356-2.409 0-.831.683-1.305 1.901-1.305 2.227 0 4.515.858 6.09 1.631l.89-5.494C18.252.975 15.697 0 12.165 0 9.667 0 7.589.654 6.104 1.872 4.56 3.147 3.757 4.992 3.757 7.218c0 4.039 2.467 5.76 6.476 7.219 2.585.92 3.445 1.574 3.445 2.583 0 .98-.84 1.545-2.354 1.545-1.875 0-4.965-.921-6.99-2.109l-.9 5.555C5.175 22.99 8.385 24 11.714 24c2.641 0 4.843-.624 6.328-1.813 1.664-1.305 2.525-3.236 2.525-5.732 0-4.128-2.524-5.851-6.591-7.305z")
                  span(class="text-xs") Stripe

    //- Footer
    footer(class="bg-discord-darkerBg/50 border-t border-discord-border/30 py-6")
      div(class="max-w-6xl mx-auto px-6")
        div(class="flex flex-col md:flex-row items-center justify-between gap-4")
          div(class="flex items-center gap-2 text-discord-textMuted text-sm")
            span © 2026 InviteChat. All rights reserved.
          div(class="flex items-center gap-6")
            a(href="/terms-of-service" class="text-discord-textMuted text-sm hover:text-discord-textNormal transition-colors") Terms of Service
            a(href="/privacy-policy" class="text-discord-textMuted text-sm hover:text-discord-textNormal transition-colors") Privacy Policy

  script.
    document.getElementById('checkout-btn')?.addEventListener('click', async () => {
      const btn = document.getElementById('checkout-btn');
      btn.disabled = true;
      btn.classList.add('opacity-75', 'cursor-not-allowed');
      btn.innerHTML = '<svg class="animate-spin w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Processing...';
      
      try {
        const response = await fetch('/create-checkout-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        
        const data = await response.json();
        
        if (data.url) {
          window.location.href = data.url;
        } else {
          throw new Error(data.error || 'Failed to create checkout session');
        }
      } catch (error) {
        alert('Error: ' + error.message);
        btn.disabled = false;
        btn.classList.remove('opacity-75', 'cursor-not-allowed');
        btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg> Get Premium Access';
      }
    });
